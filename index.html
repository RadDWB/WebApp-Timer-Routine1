<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MR Timer</title>
  <style>
    :root{
      --bg1:#0f172a; --bg2:#111827;
      --panel:rgba(255,255,255,.08);
      --panelBorder:rgba(255,255,255,.14);
      --text:#e5e7eb; --muted:#9ca3af;
      --accent1:#7c3aed; --accent2:#22d3ee;
      --ok1:#10b981; --ok2:#34d399;
      --amber:#f59e0b; --danger:#ef4444;
      --track:#1f2937; --dot:#334155; --dotActive:#22c55e;
    }

    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:28px;
      background:
        radial-gradient(1100px 700px at 15% 0%, rgba(124,58,237,.18), transparent 60%),
        radial-gradient(900px 650px at 90% 20%, rgba(34,211,238,.14), transparent 60%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--text); font-family:ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    .container{
      width:100%; max-width:720px;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--panelBorder);
      border-radius:26px; padding:26px 24px 18px;
      backdrop-filter: blur(16px) saturate(120%);
      box-shadow: 0 24px 80px rgba(0,0,0,.45);
    }

    h1{
      margin:0 0 16px; text-align:center; font-size:32px; font-weight:900; letter-spacing:.3px;
      background:linear-gradient(135deg,var(--accent2),var(--accent1));
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;
    }
    .lang{
      display:flex; gap:6px; background:rgba(255,255,255,.06); border:1px solid var(--panelBorder);
      padding:4px; border-radius:999px;
    }
    .lang button{
      border:none; padding:6px 10px; border-radius:999px; cursor:pointer; font-weight:800; font-size:12px;
      color:var(--text); background:transparent;
    }
    .lang button.active{
      color:#0b1020; background:linear-gradient(135deg,var(--accent2),var(--accent1));
    }

    /* Phase / Stepper */
    .phase{
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid var(--panelBorder);
      border-radius:18px; padding:18px 16px; margin-bottom:18px;
    }
    .phase-top{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
    .phase-title{ font-weight:800; font-size:16px; text-transform:uppercase; letter-spacing:.8px; }
    .phase-count{ font-weight:800; opacity:.85; }

    .stepper{ position:relative; padding:18px 8px 0; }
    .stepper-track{ position:relative; height:6px; background:var(--track); border-radius:999px; }
    .stepper-fill{
      position:absolute; left:0; top:0; bottom:0; width:0%;
      background:linear-gradient(90deg,var(--ok1),var(--ok2)); border-radius:999px;
      transition:width .45s ease; box-shadow:0 0 0 1px rgba(0,0,0,.15) inset;
    }
    .stepper-dots{
      position:absolute; left:0; right:0; top:50%; transform:translateY(-50%);
      display:grid; grid-template-columns:repeat(10,1fr); gap:0; padding:0 2px; pointer-events:none;
    }
    .dot{
      width:14px; height:14px; border-radius:999px; justify-self:center;
      background:var(--dot); border:2px solid rgba(255,255,255,.12);
      box-shadow:0 2px 6px rgba(0,0,0,.25);
      transition:transform .2s ease, background .2s ease, border-color .2s ease;
    }
    .dot.active{ background:var(--dotActive); border-color:rgba(34,197,94,.5); transform:scale(1.05); }

    .stepper-labels{
      margin-top:16px; display:grid; grid-template-columns:repeat(10,1fr); align-items:start; padding:0 2px;
    }
    .step-label{
      justify-self:center; font-size:11px; font-weight:800; letter-spacing:.5px; color:#e5e7eb; opacity:.95;
      writing-mode: vertical-rl; text-orientation: mixed; user-select:none; cursor:help; line-height:1;
    }

    /* Timer */
    .timer{text-align:center;}
    .time{
      font-variant-numeric:tabular-nums; font-size:72px; font-weight:900; line-height:1; margin:6px 0 12px;
    }
    .timebar{
      width:100%; height:12px; background:rgba(255,255,255,.08); border:1px solid var(--panelBorder);
      border-radius:999px; overflow:hidden; margin-bottom:18px;
    }
    .timebar-fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent2),var(--accent1)); transition:width 1s linear; }

    /* Controls */
    .chips{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:18px; }
    .chip{
      padding:10px 16px; border-radius:999px; font-weight:800; font-size:15px; letter-spacing:.3px; cursor:pointer;
      background:rgba(255,255,255,.06); border:1px solid var(--panelBorder); color:var(--text);
      transition:transform .15s ease, background .15s ease, color .15s ease, border-color .15s ease;
    }
    .chip:hover{ transform:translateY(-2px); }
    .chip.active{ background:linear-gradient(135deg,var(--accent2),var(--accent1)); color:#0b1020; border-color:transparent; }

    .controls{ display:flex; justify-content:center; gap:14px; }
    .btn{
      padding:14px 24px; border:none; border-radius:16px; font-weight:900; letter-spacing:.6px; text-transform:uppercase; cursor:pointer;
      color:#0b1020; transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }
    .btn:active{ transform: translateY(0); filter: brightness(.98); }
    .start-btn{ background: linear-gradient(135deg, var(--ok2), var(--ok1)); box-shadow:0 8px 18px rgba(16,185,129,.35); }
    .pause-btn{ background: linear-gradient(135deg, #fde047, var(--amber)); color:#1f2937; box-shadow:0 8px 18px rgba(245,158,11,.35); }
    .reset-btn{ background: linear-gradient(135deg, #fb7185, var(--danger)); color:#fff; box-shadow:0 8px 18px rgba(239,68,68,.35); }

    .stats{
      display:flex; justify-content:space-around; margin-top:16px; padding:14px;
      background: rgba(255,255,255,.06); border:1px solid var(--panelBorder); border-radius:16px;
    }
    .stat{ text-align:center; }
    .stat-label{ font-size:13px; color:#9ca3af; margin-bottom:2px; }
    .stat-value{ font-size:20px; font-weight:800; }

    .footer{ text-align:center; margin-top:16px; font-size:12px; color:#9ca3af; }
    @media (max-width:420px){
      .time{ font-size:58px; }
      .step-label{ font-size:10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MR Timer</h1>

    <div class="topbar">
      <div style="opacity:.001">.</div>
      <div class="lang" role="group" aria-label="Language">
        <button id="langDe" class="active">DE</button>
        <button id="langEn">EN</button>
      </div>
    </div>

    <div class="phase">
      <div class="phase-top">
        <div class="phase-title" id="phaseTitle">Schritt 1: Lymph-Hop</div>
        <div class="phase-count" id="phaseCount">1 / 10</div>
      </div>

      <div class="stepper">
        <div class="stepper-track">
          <div class="stepper-fill" id="phaseFill" style="width:0%"></div>
          <div class="stepper-dots" id="dots"></div>
        </div>

        <div class="stepper-labels" id="labels">
          <div class="step-label" data-i="0" title="Lymph-Hop">LH</div>
          <div class="step-label" data-i="1" title="Body wave">BW</div>
          <div class="step-label" data-i="2" title="Alternate arm swing">AS</div>
          <div class="step-label" data-i="3" title="Trunk twist">TT</div>
          <div class="step-label" data-i="4" title="Dead arms">DA</div>
          <div class="step-label" data-i="5" title="Golf swing">GS</div>
          <div class="step-label" data-i="6" title="Wind mill">WM</div>
          <div class="step-label" data-i="7" title="Slap March">SM</div>
          <div class="step-label" data-i="8" title="Lunges">LG</div>
          <div class="step-label" data-i="9" title="Cool down">CD</div>
        </div>
      </div>
    </div>

    <div class="timer">
      <div class="time" id="time">00:00</div>
      <div class="timebar"><div class="timebar-fill" id="timeFill"></div></div>
    </div>

    <div class="chips">
      <button class="chip" data-duration="15">15s</button>
      <button class="chip" data-duration="30">30s</button>
      <button class="chip active" data-duration="45">45s</button>
      <button class="chip" data-duration="60">60s</button>
    </div>

    <div class="controls">
      <button class="btn start-btn" id="startBtn">Start</button>
      <button class="btn pause-btn" id="pauseBtn" style="display:none;">Pause</button>
      <button class="btn reset-btn" id="resetBtn">Reset</button>
    </div>

    <div class="stats">
      <div class="stat">
        <div class="stat-label">Durchlauf</div>
        <div class="stat-value" id="roundStat">1/10</div>
      </div>
      <div class="stat">
        <div class="stat-label">Gesamtzeit</div>
        <div class="stat-value" id="totalTime">00:00</div>
      </div>
    </div>

    <div class="footer">© 2025 RADWB</div>
  </div>

  <script>
    /* Phasen (EN + DE) – UI-Name vs. Sprach-Name für Phase 1 getrennt */
    const phases = [
      { number: 1,  nameEn: "Lymphatic Hop",  nameDe: "Lymph-Hop", nameDeSpeak: "Lümf-Hop", short: "LH" },
      { number: 2,  nameEn: "Body wave",      nameDe: "Körperwelle",                     short: "BW" },
      { number: 3,  nameEn: "Alternate arm swing", nameDe: "Alternierender Armschwung",  short: "AS" },
      { number: 4,  nameEn: "Trunk twist",    nameDe: "Rumpfdrehungen",                  short: "TT" },
      { number: 5,  nameEn: "Dead arms",      nameDe: "Tote Arme",                       short: "DA" },
      { number: 6,  nameEn: "Golf swing",     nameDe: "Golfschwünge",                    short: "GS" },
      { number: 7,  nameEn: "Wind mill",      nameDe: "Windmühle",                       short: "WM" },
      { number: 8,  nameEn: "Slap March",     nameDe: "Knieheber",                          short: "SM" },
      { number: 9,  nameEn: "Lunges",         nameDe: "Ausfallschritte",                 short: "LG" },
      { number: 10, nameEn: "Cool down",      nameDe: "Cool Down",                       short: "CD" }
    ];

    /* Sprache */
    let currentLang = 'de';
    const langBtnDe = document.getElementById('langDe');
    const langBtnEn = document.getElementById('langEn');
    langBtnDe.addEventListener('click', ()=> setLang('de'));
    langBtnEn.addEventListener('click', ()=> setLang('en'));

    function setLang(lang){
      currentLang = lang;
      langBtnDe.classList.toggle('active', lang==='de');
      langBtnEn.classList.toggle('active', lang==='en');
      updatePhaseHeader();
      updateTooltips();
    }
    function getPhaseName(p){ return currentLang === 'de' ? p.nameDe : p.nameEn; }
    function getSpokenPhaseName(p){
      if (currentLang === 'de') return p.nameDeSpeak || p.nameDe;
      return p.nameEn;
    }
    function getLangHint(){ return currentLang === 'de' ? 'de-DE' : 'en-US'; }

    /* Zahlen als Worte */
    const EN_NUM = ["one","two","three","four","five","six","seven","eight","nine","ten"];
    const DE_NUM = ["eins","zwei","drei","vier","fünf","sechs","sieben","acht","neun","zehn"];
    function getStepIntro(n){
      return currentLang === 'de' ? `Schritt ${DE_NUM[n-1]}` : `Step ${EN_NUM[n-1]}`;
    }

    function updateTooltips(){
      document.querySelectorAll('.step-label').forEach(el=>{
        const i = +el.dataset.i;
        el.title = getPhaseName(phases[i]);
      });
    }

    /* State */
    let idx = 0;
    let duration = 45;         // Standard
    let remaining = duration;
    let running = false, paused = false;
    let tInterval = null, totalInterval = null;
    let totalElapsed = 0;

    /* Elements */
    const timeEl = document.getElementById('time');
    const timeFill = document.getElementById('timeFill');
    const phaseTitle = document.getElementById('phaseTitle');
    const phaseCount = document.getElementById('phaseCount');
    const phaseFill = document.getElementById('phaseFill');
    const roundStat = document.getElementById('roundStat');
    const totalTimeEl = document.getElementById('totalTime');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');

    /* Dots bauen */
    const dotsWrap = document.getElementById('dots');
    const dots = [];
    for(let i=0;i<10;i++){
      const d = document.createElement('div');
      d.className = 'dot';
      dotsWrap.appendChild(d);
      dots.push(d);
    }

    /* Wake Lock */
    let wakeLock = null;
    async function requestWakeLock() {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeLock.addEventListener('release', () => console.log('Wake Lock freigegeben'));
        }
      } catch (err) { console.error(`${err.name}: ${err.message}`); }
    }
    function releaseWakeLock() { if (wakeLock) { wakeLock.release(); wakeLock = null; } }
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && running) requestWakeLock();
    });

    /* Audio (Beeps) */
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    async function unlockAudio(){ try{ if(audioCtx.state === 'suspended') await audioCtx.resume(); }catch(e){} }
    function beep({freq=720, dur=0.20, vol=0.40} = {}){
      const t0 = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, t0);
      gain.gain.setValueAtTime(vol, t0);
      gain.gain.exponentialRampToValueAtTime(0.01, t0 + dur);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(t0); osc.stop(t0 + dur + 0.02);
    }

    /* Speech */
    function speak(text, langHint='en-US'){
      if(!('speechSynthesis' in window)) return;
      window.speechSynthesis.cancel();
      setTimeout(()=>{
        const u = new SpeechSynthesisUtterance(text);
        u.lang = langHint; u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
        const voices = window.speechSynthesis.getVoices();
        const base = langHint.split('-')[0].toLowerCase();
        const v = voices.find(v=> (v.lang||'').toLowerCase().startsWith(base));
        if(v) u.voice = v;
        speechSynthesis.speak(u);
      }, 100);
    }

    /* UI Updates */
    function fmt(sec){ const m = Math.floor(sec/60), s = sec%60; return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
    function updateTimer(){
      timeEl.textContent = fmt(remaining);
      const p = ((duration - remaining)/duration)*100;
      timeFill.style.width = `${p}%`;
    }
    function updatePhaseHeader(){
      const p = phases[idx];
      const name = getPhaseName(p);
      const stepWord = currentLang === 'de' ? 'Schritt' : 'Step';
      phaseTitle.textContent = `${stepWord} ${p.number}: ${name}`;
      phaseCount.textContent = `${p.number} / 10`;
      roundStat.textContent = `${p.number}/10`;
      phaseFill.style.width = `${(idx/10)*100}%`;
      dots.forEach((d,i)=> d.classList.toggle('active', i <= idx-1));
    }
    function updateTotal(){ totalTimeEl.textContent = fmt(totalElapsed); }

    /* Ablauf */
    function startPhase(){
      const p = phases[idx];
      remaining = duration;
      updateTimer();
      updatePhaseHeader();
      const intro = getStepIntro(p.number);      // "Schritt eins" / "Step one"
      const spoken = getSpokenPhaseName(p);      // "Lümf-Hop" nur für TTS bei DE
      speak(`${intro}. ${spoken}`, getLangHint());
    }

    function tick(){
      if(remaining > 0){
        if(remaining === 3 || remaining === 2){
          beep({freq:720, dur:0.20, vol:0.40});
        } else if(remaining === 1){
          beep({freq:760, dur:0.36, vol:0.45});  // längerer Abschluss
        }
        remaining--;
        updateTimer();
      }else{
        if(idx < phases.length - 1){
          dots[idx].classList.add('active');
          idx++;
          setTimeout(startPhase, 320);
        }else{
          stop();
          phaseFill.style.width = '100%';
          dots.forEach(d=>d.classList.add('active'));
          if(currentLang === 'de'){
            setTimeout(()=> speak('Routine abgeschlossen! Großartige Arbeit, mein Held! Hab einen tollen Tag.', 'de-DE'), 450);
          }else{
            setTimeout(()=> speak('Routine done! Great Job, Hero! Enjoy your Day.', 'en-US'), 450);
          }
          setTimeout(()=>{ idx = 0; updatePhaseHeader(); }, 1200);
        }
      }
    }

    function start(){
      if(running) return;
      running = true; paused = false;
      startBtn.style.display = 'none';
      pauseBtn.style.display = 'inline-block';
      unlockAudio();
      requestWakeLock();
      if(remaining === duration && idx === 0) startPhase();
      tInterval = setInterval(tick, 1000);
      totalInterval = setInterval(()=>{ totalElapsed++; updateTotal(); }, 1000);
    }

    function pause(){
      if(!running && !paused) return;
      if(!paused){
        paused = true; running = false;
        clearInterval(tInterval); clearInterval(totalInterval);
        pauseBtn.textContent = 'Resume';
        releaseWakeLock();
      }else{
        paused = false; running = true;
        requestWakeLock();
        tInterval = setInterval(tick, 1000);
        totalInterval = setInterval(()=>{ totalElapsed++; updateTotal(); }, 1000);
        pauseBtn.textContent = 'Pause';
      }
    }

    function stop(){
      running = false; paused = false;
      clearInterval(tInterval); clearInterval(totalInterval);
      startBtn.style.display = 'inline-block';
      pauseBtn.style.display = 'none';
      pauseBtn.textContent = 'Pause';
      releaseWakeLock();
    }

    function reset(){
      stop();
      idx = 0; duration = getActiveDuration(); remaining = duration;
      totalElapsed = 0;
      updateTimer(); updateTotal(); updatePhaseHeader();
      dots.forEach(d=>d.classList.remove('active'));
      phaseFill.style.width = '0%';
    }

    /* Durations */
    function getActiveDuration(){
      const active = document.querySelector('.chip.active');
      return parseInt(active?.dataset.duration || '45', 10); // Fallback 45s
    }
    document.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        if(running) return;
        document.querySelectorAll('.chip').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        duration = parseInt(btn.dataset.duration,10);
        remaining = duration;
        updateTimer();
      });
    });

    /* Bindings */
    startBtn.addEventListener('click', start);
    pauseBtn.addEventListener('click', pause);
    resetBtn.addEventListener('click', reset);

    /* Init */
    duration = getActiveDuration();
    remaining = duration;
    updateTimer(); updatePhaseHeader(); updateTotal(); updateTooltips();

    if('speechSynthesis' in window){
      const preload = ()=> speechSynthesis.getVoices();
      preload();
      if(speechSynthesis.onvoiceschanged !== undefined){
        speechSynthesis.onvoiceschanged = preload;
      }
    }
  </script>
</body>
</html>
